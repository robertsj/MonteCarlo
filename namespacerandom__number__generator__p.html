<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>monte: random_number_generator_p Module Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.3 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">monte</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="namespaces.html"><span>Modules</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="namespaces.html"><span>Modules&#160;List</span></a></li>
      <li><a href="namespacemembers.html"><span>Module&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#func-members">Functions/Subroutines</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<h1>random_number_generator_p Module Reference</h1>  </div>
</div>
<div class="contents">

<p>Provides a simple implementation of the MCNP standard PRNG.  
<a href="#_details">More...</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions/Subroutines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">real(<a class="el" href="namespacerandom__number__generator__p.html#aced5bdecd7212445e0bc833d319498d7">R8</a>), public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacerandom__number__generator__p.html#a0b8c7b5a6e0174abcff36a386101e3c1">rand</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Obtain a single 64 bit real pseudo random number.  <a href="#a0b8c7b5a6e0174abcff36a386101e3c1"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacerandom__number__generator__p.html#a9e2530fee03671b0fc7fc96756318905">initialize_rng</a> (UserS, UserStride)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Initiates the random number generator for a new problem.  <a href="#a9e2530fee03671b0fc7fc96756318905"></a><br/></td></tr>
<tr><td colspan="2"><h2><a name="var-members"></a>
Variables</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">integer, parameter&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacerandom__number__generator__p.html#aced5bdecd7212445e0bc833d319498d7">R8</a> = selected_real_kind(15, 307)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">integer, parameter&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacerandom__number__generator__p.html#ad7b832223bbb929ac0b9b66499229e8a">I8</a> = selected_int_kind(18)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">integer(<a class="el" href="namespacerandom__number__generator__p.html#ad7b832223bbb929ac0b9b66499229e8a">I8</a>), save&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacerandom__number__generator__p.html#a13e8c70886848722d5ce97d76b5b3876">g</a> = 19073486328125_I8</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">integer(<a class="el" href="namespacerandom__number__generator__p.html#ad7b832223bbb929ac0b9b66499229e8a">I8</a>), save&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacerandom__number__generator__p.html#adc0bcd225bcdce3c3cf70341c086fc39">c</a> = 0_I8</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">integer(<a class="el" href="namespacerandom__number__generator__p.html#ad7b832223bbb929ac0b9b66499229e8a">I8</a>), save&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacerandom__number__generator__p.html#a86c2d9526ff86a5419faf1c53d15e8e3">Stride</a> = 152917_I8</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">integer(<a class="el" href="namespacerandom__number__generator__p.html#ad7b832223bbb929ac0b9b66499229e8a">I8</a>), save&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacerandom__number__generator__p.html#a889d99d8cd4bf6c25ce91ef0467f0a78">S0</a> = 19073486328125_I8</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">integer(<a class="el" href="namespacerandom__number__generator__p.html#ad7b832223bbb929ac0b9b66499229e8a">I8</a>), save&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacerandom__number__generator__p.html#a26f69a5b41ed0b288a654dd121d0693e">TwoToMMinus1</a> = 281474976710655_I8</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">real(<a class="el" href="namespacerandom__number__generator__p.html#aced5bdecd7212445e0bc833d319498d7">R8</a>), save&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacerandom__number__generator__p.html#a93edcf91eb007838557fca333c1915d8">OneOver2toM</a> = 1._R8 / 281474976710656._R8</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">integer(<a class="el" href="namespacerandom__number__generator__p.html#ad7b832223bbb929ac0b9b66499229e8a">I8</a>), save&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacerandom__number__generator__p.html#ac86afe861f6c5991970abf31a8354fea">S</a> = 19073486328125_I8</td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<div class="textblock"><p>Provides a simple implementation of the MCNP standard PRNG. </p>
<dl class="author"><dt><b>Author:</b></dt><dd>Jeremy Roberts</dd></dl>
<p>MCNP and most other Monte Carlo codes employ LCGs, defined by the relation </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ S(k+1) = \textrm{modulo}[ (g \times S(k) + c), 2^M ] \, , \]" src="form_2.png"/>
</p>
<p> with the random number being defined </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ r(k+1) = S(k+1)/2^M \, . \]" src="form_3.png"/>
</p>
<p> For the standard MCNP LCG, </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ g = 5^19 \, \]" src="form_4.png"/>
</p>
 <p class="formulaDsp">
<img class="formulaDsp" alt="\[ c = 0 \, \]" src="form_5.png"/>
</p>
 <p class="formulaDsp">
<img class="formulaDsp" alt="\[ S(0) = 5^19 \, \]" src="form_6.png"/>
</p>
<p> and </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ M = 48 . \]" src="form_7.png"/>
</p>
<p> (Recall that <img class="formulaInl" alt="$ \textrm{modulo}[a,b] = a\, \textrm{mod} \, b $" src="form_8.png"/>).</p>
<p>For parallel jobs, we have several options for RNs. We could let each process have its own (random?) starting seed, and then perform its batch of particle histories using its own sequence. This is not the best approach, since then the same problem run using different numbers of processes would yield different results, and we like reproducing results for debugging.</p>
<p>The solution: let each history have its own sequence of a certain length called the "stride". This works since any subset of the infinite sequence defined by the first two equations above should be random. To use this approach, we need a fast way to get any <img class="formulaInl" alt="$ S(k) $" src="form_9.png"/> given <img class="formulaInl" alt="$ S(0) $" src="form_10.png"/>. This is done by </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ S(k) = \textrm{modulo}[ (g^k \times S(0) + c \times (g^k-1)/(g-1), 2^M ] \, , \]" src="form_11.png"/>
</p>
<p> which must use exact integer arithmetic. For the case that <img class="formulaInl" alt="$ c=0 $" src="form_12.png"/>, we need only compute exactly. Brown gives the following algorithm:</p>
<div class="fragment"><pre class="fragment">
     G = 1; h = g; i = modulo[k+2^m,2^m];
     do while (i .gt. 0 )
         if ( i is odd ) G = modulo[ G*h, 2^m ]
         h = modulo[ h^2 , 2^m ]
         i = floor(i/2)
     end 
 </pre></div><p>A similar algorithm exists for the other term. See the "Fundamentals..." notes for more.</p>
<p>It's worth pointing out use of the Fortran intrinsics "iand" and "btest" below. These are "bitwise and" and "bitwise test", respectively. To give a flavor... </p>
<div class="fragment"><pre class="fragment">
   iand(1,2) compares [1000...] to [0100...] = 0
   iand(1,3) compares [1000...] to [1100...] = 0*2^0 + 1*2^1 ... = 2
 </pre></div><p> and so on. A good exercise would be to show why </p>
<div class="fragment"><pre class="fragment">
   S(k) = modulo[ (g^k*S(0)+c*(g^k-1)/(g-1), 2^M ]
        = iand( iand( g*S(0), 2^M-1 ) + c,  2^M-1 ) 
 </pre></div><p> Hint: Show </p>
<div class="fragment"><pre class="fragment">
   modulo[a+b,c] = modulo[modulo[a,c]+b,c]
 </pre></div><p> Then show </p>
<div class="fragment"><pre class="fragment">
   iand(a,c-1) = modulo(a,c) 
 </pre></div><p> when c is a power of 2.</p>
<p>References:</p>
<ul>
<li>"THE MCNP5 RANDOM NUMBER GENERATOR", LA-UR-02-3782 <a href="http://mcnp-green.lanl.gov/publication/pdf/LA-UR-02-3782.pdf">http://mcnp-green.lanl.gov/publication/pdf/LA-UR-02-3782.pdf</a></li>
<li>"FUNDAMENTALS OF MONTE CARLO TRANSPORT", LA-UR-05-4983 <a href="http://...gov/publication/pdf/LA-UR-05-4983_Monte_Carlo_Lectures.pdf">http://...gov/publication/pdf/LA-UR-05-4983_Monte_Carlo_Lectures.pdf</a> </li>
</ul>
</div><hr/><h2>Function/Subroutine Documentation</h2>
<a class="anchor" id="a9e2530fee03671b0fc7fc96756318905"></a><!-- doxytag: member="random_number_generator_p::initialize_rng" ref="a9e2530fee03671b0fc7fc96756318905" args="(UserS, UserStride)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine,public random_number_generator_p::initialize_rng </td>
          <td>(</td>
          <td class="paramtype">integer(I8),intent(in)&#160;</td>
          <td class="paramname"><em>UserS</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer(I8),intent(in)&#160;</td>
          <td class="paramname"><em>UserStride</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Initiates the random number generator for a new problem. </p>
<p>Warning: ONLY CALL THIS FROM THE MASTER THREAD!</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">UserS</td><td>Integer value of seed (default is 5^19) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">UserString</td><td>Integer value of stride between histories </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="random__number__generator__p_8f90_source.html#l00186">186</a> of file <a class="el" href="random__number__generator__p_8f90_source.html">random_number_generator_p.f90</a>.</p>

<p>References <a class="el" href="random__number__generator__p_8f90_source.html#l00117">S</a>, <a class="el" href="random__number__generator__p_8f90_source.html#l00112">S0</a>, and <a class="el" href="random__number__generator__p_8f90_source.html#l00111">Stride</a>.</p>

</div>
</div>
<a class="anchor" id="a0b8c7b5a6e0174abcff36a386101e3c1"></a><!-- doxytag: member="random_number_generator_p::rand" ref="a0b8c7b5a6e0174abcff36a386101e3c1" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">real(<a class="el" href="namespacerandom__number__generator__p.html#aced5bdecd7212445e0bc833d319498d7">R8</a>),public random_number_generator_p::rand </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Obtain a single 64 bit real pseudo random number. </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>random number </dd></dl>

<p>Definition at line <a class="el" href="random__number__generator__p_8f90_source.html#l00128">128</a> of file <a class="el" href="random__number__generator__p_8f90_source.html">random_number_generator_p.f90</a>.</p>

<p>References <a class="el" href="random__number__generator__p_8f90_source.html#l00110">c</a>, <a class="el" href="random__number__generator__p_8f90_source.html#l00109">g</a>, <a class="el" href="random__number__generator__p_8f90_source.html#l00114">OneOver2toM</a>, <a class="el" href="random__number__generator__p_8f90_source.html#l00117">S</a>, and <a class="el" href="random__number__generator__p_8f90_source.html#l00113">TwoToMMinus1</a>.</p>

</div>
</div>
<hr/><h2>Variable Documentation</h2>
<a class="anchor" id="adc0bcd225bcdce3c3cf70341c086fc39"></a><!-- doxytag: member="random_number_generator_p::c" ref="adc0bcd225bcdce3c3cf70341c086fc39" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">integer(<a class="el" href="namespacerandom__number__generator__p.html#ad7b832223bbb929ac0b9b66499229e8a">I8</a>),save <a class="el" href="namespacerandom__number__generator__p.html#adc0bcd225bcdce3c3cf70341c086fc39">random_number_generator_p::c</a> = 0_I8</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="random__number__generator__p_8f90_source.html#l00110">110</a> of file <a class="el" href="random__number__generator__p_8f90_source.html">random_number_generator_p.f90</a>.</p>

<p>Referenced by <a class="el" href="random__number__generator__p_8f90_source.html#l00128">rand()</a>.</p>

</div>
</div>
<a class="anchor" id="a13e8c70886848722d5ce97d76b5b3876"></a><!-- doxytag: member="random_number_generator_p::g" ref="a13e8c70886848722d5ce97d76b5b3876" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">integer(<a class="el" href="namespacerandom__number__generator__p.html#ad7b832223bbb929ac0b9b66499229e8a">I8</a>),save <a class="el" href="namespacerandom__number__generator__p.html#a13e8c70886848722d5ce97d76b5b3876">random_number_generator_p::g</a> = 19073486328125_I8</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="random__number__generator__p_8f90_source.html#l00109">109</a> of file <a class="el" href="random__number__generator__p_8f90_source.html">random_number_generator_p.f90</a>.</p>

<p>Referenced by <a class="el" href="random__number__generator__p_8f90_source.html#l00128">rand()</a>.</p>

</div>
</div>
<a class="anchor" id="ad7b832223bbb929ac0b9b66499229e8a"></a><!-- doxytag: member="random_number_generator_p::I8" ref="ad7b832223bbb929ac0b9b66499229e8a" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">integer,parameter <a class="el" href="namespacerandom__number__generator__p.html#ad7b832223bbb929ac0b9b66499229e8a">random_number_generator_p::I8</a> = selected_int_kind(18)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="random__number__generator__p_8f90_source.html#l00101">101</a> of file <a class="el" href="random__number__generator__p_8f90_source.html">random_number_generator_p.f90</a>.</p>

</div>
</div>
<a class="anchor" id="a93edcf91eb007838557fca333c1915d8"></a><!-- doxytag: member="random_number_generator_p::OneOver2toM" ref="a93edcf91eb007838557fca333c1915d8" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">real(<a class="el" href="namespacerandom__number__generator__p.html#aced5bdecd7212445e0bc833d319498d7">R8</a>),save <a class="el" href="namespacerandom__number__generator__p.html#a93edcf91eb007838557fca333c1915d8">random_number_generator_p::OneOver2toM</a> = 1._R8 / 281474976710656._R8</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="random__number__generator__p_8f90_source.html#l00114">114</a> of file <a class="el" href="random__number__generator__p_8f90_source.html">random_number_generator_p.f90</a>.</p>

<p>Referenced by <a class="el" href="random__number__generator__p_8f90_source.html#l00128">rand()</a>.</p>

</div>
</div>
<a class="anchor" id="aced5bdecd7212445e0bc833d319498d7"></a><!-- doxytag: member="random_number_generator_p::R8" ref="aced5bdecd7212445e0bc833d319498d7" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">integer,parameter <a class="el" href="namespacerandom__number__generator__p.html#aced5bdecd7212445e0bc833d319498d7">random_number_generator_p::R8</a> = selected_real_kind(15, 307)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="random__number__generator__p_8f90_source.html#l00100">100</a> of file <a class="el" href="random__number__generator__p_8f90_source.html">random_number_generator_p.f90</a>.</p>

</div>
</div>
<a class="anchor" id="ac86afe861f6c5991970abf31a8354fea"></a><!-- doxytag: member="random_number_generator_p::S" ref="ac86afe861f6c5991970abf31a8354fea" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">integer(<a class="el" href="namespacerandom__number__generator__p.html#ad7b832223bbb929ac0b9b66499229e8a">I8</a>),save <a class="el" href="namespacerandom__number__generator__p.html#ac86afe861f6c5991970abf31a8354fea">random_number_generator_p::S</a> = 19073486328125_I8</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="random__number__generator__p_8f90_source.html#l00117">117</a> of file <a class="el" href="random__number__generator__p_8f90_source.html">random_number_generator_p.f90</a>.</p>

<p>Referenced by <a class="el" href="random__number__generator__p_8f90_source.html#l00186">initialize_rng()</a>, and <a class="el" href="random__number__generator__p_8f90_source.html#l00128">rand()</a>.</p>

</div>
</div>
<a class="anchor" id="a889d99d8cd4bf6c25ce91ef0467f0a78"></a><!-- doxytag: member="random_number_generator_p::S0" ref="a889d99d8cd4bf6c25ce91ef0467f0a78" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">integer(<a class="el" href="namespacerandom__number__generator__p.html#ad7b832223bbb929ac0b9b66499229e8a">I8</a>),save <a class="el" href="namespacerandom__number__generator__p.html#a889d99d8cd4bf6c25ce91ef0467f0a78">random_number_generator_p::S0</a> = 19073486328125_I8</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="random__number__generator__p_8f90_source.html#l00112">112</a> of file <a class="el" href="random__number__generator__p_8f90_source.html">random_number_generator_p.f90</a>.</p>

<p>Referenced by <a class="el" href="random__number__generator__p_8f90_source.html#l00186">initialize_rng()</a>.</p>

</div>
</div>
<a class="anchor" id="a86c2d9526ff86a5419faf1c53d15e8e3"></a><!-- doxytag: member="random_number_generator_p::Stride" ref="a86c2d9526ff86a5419faf1c53d15e8e3" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">integer(<a class="el" href="namespacerandom__number__generator__p.html#ad7b832223bbb929ac0b9b66499229e8a">I8</a>),save <a class="el" href="namespacerandom__number__generator__p.html#a86c2d9526ff86a5419faf1c53d15e8e3">random_number_generator_p::Stride</a> = 152917_I8</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="random__number__generator__p_8f90_source.html#l00111">111</a> of file <a class="el" href="random__number__generator__p_8f90_source.html">random_number_generator_p.f90</a>.</p>

<p>Referenced by <a class="el" href="random__number__generator__p_8f90_source.html#l00186">initialize_rng()</a>.</p>

</div>
</div>
<a class="anchor" id="a26f69a5b41ed0b288a654dd121d0693e"></a><!-- doxytag: member="random_number_generator_p::TwoToMMinus1" ref="a26f69a5b41ed0b288a654dd121d0693e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">integer(<a class="el" href="namespacerandom__number__generator__p.html#ad7b832223bbb929ac0b9b66499229e8a">I8</a>),save <a class="el" href="namespacerandom__number__generator__p.html#a26f69a5b41ed0b288a654dd121d0693e">random_number_generator_p::TwoToMMinus1</a> = 281474976710655_I8</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="random__number__generator__p_8f90_source.html#l00113">113</a> of file <a class="el" href="random__number__generator__p_8f90_source.html">random_number_generator_p.f90</a>.</p>

<p>Referenced by <a class="el" href="random__number__generator__p_8f90_source.html#l00128">rand()</a>.</p>

</div>
</div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Sun Jan 29 2012 16:12:42 for monte by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.3 </small></address>
</body>
</html>
